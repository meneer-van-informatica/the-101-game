<main>
  <h1>W0 ‚Äì The 101 Game</h1>
  <p>Lampen schakelen vanaf je telefoon.</p>

  <div class="row">
    <button id="btn-on" class="ok">üí° Lampen Aan</button>
    <button id="btn-home" class="home" disabled>üè† HOME</button>
    <button id="btn-off" class="off" disabled>üï≥Ô∏è Lampen Uit</button>
    <button id="btn-toggle" class="toggle" disabled>‚ÜîÔ∏è Toggle</button>
  </div>
  <div id="status">‚è≥ klaar</div>

  <nav><a href="./index.html">Terug</a></nav>
</main>

<script>
  const ON = 'https://the-101-game-lampen.<jouwsub>.workers.dev/api/lampen/aan';
  const OFF = 'https://the-101-game-lampen.<jouwsub>.workers.dev/api/lampen/uit';

  const S = document.getElementById('status');
  const btnOn = document.getElementById('btn-on');
  const btnHome = document.getElementById('btn-home');
  const btnOff = document.getElementById('btn-off');
  const btnToggle = document.getElementById('btn-toggle');
  
  let timer;
  let countdown = 30;
  
  async function call(url, what) {
    S.textContent = `‚è≥ ${what}...`;
    try {
      const r = await fetch(url, { method: 'POST', mode: 'cors' });
      if (r.ok) { 
        S.textContent = `‚úÖ ${what} succesvol!`;
        localStorage.lamp_last = what;
      } else {
        S.textContent = `‚ùå ${what} mislukt! (${r.status})`;
      }
    } catch (e) {
      S.textContent = '‚ùå Netwerkfout';
    }
  }

  btnOn.onclick = () => {
    call(ON, 'Lamp aan');
    startTimer();
    btnHome.disabled = false;
  };
  
  btnHome.onclick = () => {
    if (timer) clearInterval(timer);
    btnOff.disabled = false;
    btnToggle.disabled = false;
    S.textContent = '‚úÖ Verbinding gemaakt! Lampen kunnen nu bediend worden.';
  };

  btnOff.onclick = () => call(OFF, 'Lamp uit');
  
  btnToggle.onclick = () => {
    const last = localStorage.lamp_last || 'uit';
    (last === 'aan') ? call(OFF, 'Lamp uit') : call(ON, 'Lamp aan');
  };

  function startTimer() {
    countdown = 30;
    S.textContent = `‚è≥ Timer: ${countdown}s`;
    timer = setInterval(() => {
      countdown--;
      if (countdown <= 0) {
        clearInterval(timer);
        btnHome.disabled = true;
        S.textContent = '‚ùå Tijd is om! Probeer opnieuw.';
      } else {
        S.textContent = `‚è≥ Timer: ${countdown}s`;
      }
    }, 1000);
  }

  if (localStorage.lamp_last) S.textContent = `‚ÑπÔ∏è Laatst: ${localStorage.lamp_last}`;
</script>

<style>
  body { font-family: system-ui, sans-serif; max-width: 720px; margin: 2rem auto; padding: 0 1rem; background: #1e1e1e; color: #fff; }
  .row { display: flex; gap: .75rem; flex-wrap: wrap; margin: 1rem 0; }
  button { padding: 1rem 1.25rem; border: 0; font-size: 1.05rem; cursor: pointer; border-radius: .5rem; }
  .ok  { background: #0a0; color: #fff; }
  .off { background: #444; color: #fff; }
  .home { background: #ff6600; color: #fff; }
  .toggle { background: #0057d9; color: #fff; }
  #status { margin-top: .5rem; opacity: .8; }
  
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>
